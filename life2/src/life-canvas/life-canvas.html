<html><head><meta charset="UTF-8"><link rel="import" href="../../shared-bundle.html"></head><body><dom-module id="life-canvas">
  <template>
    <canvas width="600" height="600" id="canvas">Your browser doesn't support html5 canvas.</canvas>
    
  </template>

  <script>var Cell=function(e,a){this.x=e,this.y=a,this.state=0,this._state=0};Cell._getCellStateAt=function(e,a){return e<0||a<0||e>=this.gameManager.CELL_LENGTH||a>=this.gameManager.CELL_LENGTH?0:this.gameManager.cells[e+a*this.gameManager.CELL_LENGTH]._state},Cell.getCellAt=function(e,a){return e<0||a<0||e>=this.gameManager.CELL_LENGTH||a>=this.gameManager.CELL_LENGTH?null:this.gameManager.cells[e+a*this.gameManager.CELL_LENGTH]},Cell.prototype.draw=function(){this.state&&(Cell.gameManager.context.fillStyle="#ff0000",Cell.gameManager.context.fillRect(this.x*Cell.gameManager.CELL_SIZE,this.y*Cell.gameManager.CELL_SIZE,Cell.gameManager.CELL_SIZE,Cell.gameManager.CELL_SIZE))},Cell.prototype.update=function(){var e=0,a=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];a.forEach(function(a){e+=Cell._getCellStateAt(this.x+a[0],this.y+a[1])}.bind(this)),this._state?(e<=1||e>=4)&&(this.state=0):3===e&&(this.state=1)},Polymer({is:"life-canvas",properties:{prop1:{type:String,value:"life-canvas"},app:Object},ready:function(){this.app.gameManager={},Cell.gameManager=this.app.gameManager,Cell.gameManager.CANVAS_SIZE=600,Cell.gameManager.CELL_SIZE=4,Cell.gameManager.CELL_LENGTH=Math.floor(Cell.gameManager.CANVAS_SIZE/Cell.gameManager.CELL_SIZE),Cell.gameManager.canvas=this.$.canvas,Cell.gameManager.context=Cell.gameManager.canvas.getContext("2d"),Cell.gameManager.isDrawing=!1,Cell.gameManager.cells=new Array(Cell.gameManager.CELL_LENGTH*Cell.gameManager.CELL_LENGTH);for(var e=0;e<Cell.gameManager.cells.length;e++)Cell.gameManager.cells[e]=new Cell(e%Cell.gameManager.CELL_LENGTH,Math.floor(e/Cell.gameManager.CELL_LENGTH)),Math.random()>.5;Cell.gameManager.canvas.addEventListener("click",this._plotOnClick(this),!1),Cell.gameManager.canvas.addEventListener("mousemove",this._handlePlotSeq(this),!1),Cell.gameManager.canvas.addEventListener("mousedown",this._handlePlotStart(this),!1),Cell.gameManager.canvas.addEventListener("mouseup",this._handlePlotEnd(this),!1),this.mainLoop()},_plotOnClick:function(e){return function(a){var t=a.target.getBoundingClientRect(),n=a.clientX-t.left,l=a.clientY-t.top;e.injectPattern(Math.floor(n/e.app.gameManager.CELL_SIZE),Math.floor(l/e.app.gameManager.CELL_SIZE),e.app.catalog[e.app.selected])}},_handlePlotStart:function(e){return function(a){e.app.gameManager.isDrawing=!0}},_handlePlotSeq:function(e){return function(a){e.app.gameManager.isDrawing&&e._plotOnClick(e)(a)}},_handlePlotEnd:function(e){return function(a){e.app.gameManager.isDrawing=!1}},mainLoop:function(){this.app.gameManager.context.fillStyle="#eeeeee",this.app.gameManager.context.fillRect(0,0,this.app.gameManager.canvas.width,this.app.gameManager.canvas.height),this.app.gameManager.cells.forEach(function(e){e._state=e.state,e.draw()}),this.app.gameManager.cells.forEach(function(e){e.update()}),setTimeout(function(){this.mainLoop()}.bind(this),30)},injectPattern:function(e,a,t){var n,l;for(n=0;n<t.length;n++)for(l=0;l<t[n].length;l++)"1"===t[n][l]&&(Cell.getCellAt(e+l,a+n).state=1)}});</script>
</dom-module>
</body></html>