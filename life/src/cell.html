<html><head><script>var Cell=function(t,e){this.x=t,this.y=e,this.state=0,this._state=0,this.color="rgb(255, 0, 0)"};Cell.prototype.update=function(t){this._state?(t<=1||t>=4)&&(this.state=0):3===t&&(this.state=1)};var GameManager=function(t,e,i,s){this.CELL_WIDTH=t,this.CELL_HEIGHT=e,this.CELL_SIZE=i,this.canvas=s,this.context=s.getContext("2d"),this.cells=new Array(this.CELL_WIDTH*this.CELL_HEIGHT);for(var a=0;a<this.cells.length;a++)this.cells[a]=new Cell(a%this.CELL_WIDTH,Math.floor(a/this.CELL_WIDTH))};GameManager.prototype.getCellAt=function(t,e){return t<0||e<0||t>=this.CELL_WIDTH||e>=this.CELL_HEIGHT?null:this.cells[t+e*this.CELL_WIDTH]},GameManager.prototype._getCellStateAt=function(t,e){return t<0||e<0||t>=this.CELL_WIDTH||e>=this.CELL_HEIGHT?0:this.cells[t+e*this.CELL_WIDTH]._state},GameManager.prototype.refreshCanvas=function(t,e){e?(this.context.fillStyle=t||"#eeeeee",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.drawImage(e,0,0)):(this.context.fillStyle=t||"#eeeeee",this.context.fillRect(0,0,this.canvas.width,this.canvas.height))},GameManager.prototype.draw=function(t){this.cells.forEach(function(e){e._state=e.state,e.state&&(this.context.fillStyle=t,this.context.fillRect(e.x*this.CELL_SIZE,e.y*this.CELL_SIZE,this.CELL_SIZE,this.CELL_SIZE))}.bind(this))},GameManager.prototype.update=function(){var t=[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]];this.cells.forEach(function(e){var i=0;t.forEach(function(t){i+=this._getCellStateAt(e.x+t[0],e.y+t[1])}.bind(this)),e.update(i)}.bind(this))},GameManager.prototype._parseRLE=function(t){for(var e=[],i="",s=t;s.length>0;s=s.substring(n.length)){var a=s.match(/(\d*)([bo\$!])/),n=a[0],h=a[1]||1,r=a[2];if("o"===r)i+="1".repeat(h);else if("b"===r)i+="0".repeat(h);else if("$"===r)for(var l=h;l>0;l--)e.push(i),i="";else if("!"===r){e.push(i);break}}return e},GameManager.prototype._encodeRLE=function(){var t=[],e=[];for(i=0;i<this.CELL_HEIGHT;i++){for(j=0;j<this.CELL_WIDTH;j++)e.push(this.getCellAt(j,i).state);var s=e.join("");s.includes("1")?t.push(s):t.push(""),e=[]}t=t.map(function(t){return""===t?"$":t+"$"});for(var a=t.join("").replace(/0/g,"b").replace(/1/g,"o"),n="",h=0,r="",l=a;l.length>0;l=l.substring(1))l[0]===n?h++:0===h?(n=l[0],h=1):1===h?(r+=""+n,n=l[0],h=1):h>1&&(r+=""+h+n,n=l[0],h=1);return r+="!"},GameManager.prototype.injectPattern=function(t,e,i,s){Array.isArray(i)||(i=this._parseRLE(i));var a,n;for(a=0;a<i.length;a++)for(n=0;n<i[a].length;n++)"1"===i[a][n]&&this.getCellAt(t+n,e+a)&&(this.getCellAt(t+n,e+a).state=1,this.getCellAt(t+n,e+a).color=s)},GameManager.prototype.injectOverlay=function(t,e,s,a){for(Array.isArray(s)||(s=this._parseRLE(s)),i=0;i<s.length;i++)for(j=0;j<s[i].length;j++)"1"===s[i][j]&&this.getCellAt(t+j,e+i)&&(this.context.fillStyle=a,this.context.fillRect((t+j)*this.CELL_SIZE,(e+i)*this.CELL_SIZE,this.CELL_SIZE,this.CELL_SIZE))},GameManager.prototype.clearCanvas=function(){this.cells.forEach(function(t){t.state=0,t._state=0}),this.draw()};</script>
</head><body></body></html>